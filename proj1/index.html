<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Portfolio</title>
            <!-- MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {   
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0;
          background-color: #2e2e2d; /* Slightly grey background for the page */
        }
        
        header {
          background-color: #f2f2f0; /* Dark grey top banner */
          color: white;
          text-align: center;
          padding: 2rem 1rem; /* Spacing to make the banner large */
          color: black;
        }
        
        header h1 {
          margin: 0;
          font-size: 2rem;
        }
        
        header h2 {
          margin: 1rem 0 0 0;
          font-size: 1.5rem;
        }
        
        .big_container {
          max-width: 1200px;
          margin: 1rem auto; /* Centers the container */
          background-color: silver; /* White background for content */
          padding: 1rem;
          border-radius: 5px;
          box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4); /* Subtle shadow for depth */
          color: white;   
        }
            
        .container {
          max-width: 1100px;
          margin: 2rem auto; /* Centers the container */
          background-color: #f2f2f0; /* White background for content */
          padding: 2rem;
          border-radius: 5px;
          box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4); /* Subtle shadow for depth */
          color: black;
        }
        
        .container a {
          color: #007bff; /* Blue link for "Back to Home" */
          text-decoration: none;
        }
        
        .container a:hover {
          text-decoration: underline;
        }
        
        .container h3 {
          font-size: 1.5rem;
          margin-top: 2rem;
        }
        
        .container p {
          line-height: 1.6; /* Improved readability for paragraphs */
        }

        .image-gallery {
          display: flex;
          flex-wrap: wrap;
          gap: 1.5rem;
          justify-content: flex-start;
          margin-top: 1rem;
        }
        
        .image-item {
          width: 300px;
          text-align: center;
        }
        
        .image-item img {
          width: 100%;
          height: auto;
          border-radius: 5px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
      
        .math-block {
          text-align: center;         /* Center content */
          padding: 5px 10px;              /* Spacing inside the block */
          border-radius: 5px;         /* Rounded corners */
          margin: 20px auto;          /* Center the block horizontally */
          max-width: 80%;             /* Optional: limit width */
        }
        
  </style>
    </style>  
</head>
    
<body>
    <header>
        <h1>CS 180 Project 1</h1>
            <h2>Images of the Russian Empire</h2>
    </header>
        <div class="container">
            <h2><center>Project Overview & Implementation Details</center></h2>
            <p><strong>Objective:</strong> Process Prokudin-Gorskiiâ€™s digitized glass plate images to reconstruct full-color photos.
                      Images were split into three grayscale channels (R, G, B), aligned using an x, y translation model, and stacked to form a single RGB image that best captures the original scene's true beauty!</p>
        </div>
    
        <div class="container">
            <h2><center>Algorithm Overview</center></h2>
                <p><strong>Preprocessing:</strong> After cropping out the B, G, and R images from the original triplet, my pipeline crops 10% of the image borders to eliminate potential alignment noise caused by marginal artifacts, uneven exposure, or border effects. This pre-processing step ensures that the alignment focuses on the central and structurally significant portion of the image.
                    The comparison examples below illustrate the crucialness of cropping: the absence of this preprocessing step adversely impacts final results!</p>
                <p><strong>Single-scale Alignment:</strong> For images with resolution below 1000 pixels in either dimension (a threshold that nicely separates the .jpg images from the .tif images in this assignment), my alignment algorithm follows a single-scale alignment strategy, which is optimized for accuracy at the cost of computational efficiency since it is a brute force approach.
                    The alignment is carried out using the <code>_align_single_scale</code> function, which performs an exhaustive search over a defined window (default is +-15 pixels) around a shift center (default is 0 shift), evaluating candidate displacements via an image similarity metric (more on this below).
                    For each potential (dx, dy) shift, the source channel is spatially rolled and compared against the reference using the computed similarity score. The shift that maximizes this score is selected as the optimal alignment. This approach is both accurate and reasonably fast for small or moderately-sized images. 
                    For higher-resolution images, however, this method falls apart as processing takes too long.</p>
                <p><strong>Multi-scale Alignment:</strong> For high-resolution images (i.e., those with either dimension greater than 1000 pixels), the alignment algorithm employs a multi-scale pyramid alignment strategy designed to handle the large search space efficiently while maintaining sub-pixel accuracy. 
                    This approach begins with recursive image downsampling, using a Gaussian pyramid scheme in the <code>_align_multi_scale</code> function. The source and reference images are successively rescaled by a factor of 0.5 per level (with <code>anti_aliasing=True</code> to preserve structural integrity). 
                    At the coarsest scale (default set to 5 levels deep), the algorithm performs a coarse alignment via the <code>_align_single_scale</code> function, searching for the best (dx, dy) displacement using an image similiarity metric. 
                    After finding the best shift at the lowest resolution, the algorithm propagates this alignment up the pyramid, doubling the shift at each level to approximate the corresponding shift center in higher resolutions. At each level, the algorithm performs a local refinement step in a narrow window (default set to +-5 pixels) around the upscaled shift center.
                    This hierarchical refinement continues recursively until the full-resolution images are aligned. By combining global context from coarse levels with precision from fine levels, the multi-scale pipeline efficiently and accurately aligns the larger (.tif) images. This strategy significantly reduces computational cost compared to exhaustive full-resolution search!</p>
                <p><strong>Image Similarity Metric:</strong> Two metrics are considered. The Euclidean Norm (L2 Similarity) metric, defined as:        
                <div class="math-block">
                    $$
                    L2_{similarity}(\mathbf{I_1}, \mathbf{I_2}) = -L2(\mathbf{I_1}, \mathbf{I_2})
                    $$
                </div>
                <p><center>where L2 is defined as:</center></p>
                <div class="math-block">
                    $$
                    L2(\mathbf{I_1}, \mathbf{I_2}) = \sqrt{\sum_{i,j} \left( I_1(i,j) - I_2(i,j) \right)^2}
                    $$
                </div>
            
                And the Normalized Cross-Correlation (NCC) metric, defined as:
                <div class="math-block">
                    $$
                    NCC(\mathbf{I_1}, \mathbf{I_2}) = \sum_{i,j} \left( \frac{I_1(i,j)}{\| \mathbf{I_1} \|} \cdot \frac{I_2(i,j)}{\| \mathbf{I_2} \|} \right)
                    $$
                </div>

                <p>After experimenting with both the L2 Similarity metric and the NCC metric, both produced very similar results (often with the same dx dy offsets too). I still opted for the NCC metric because it felt generally more robust. 
                    Since NCC effectively "de-means" (normalizes) the data, it should be mathematically more resistant to "uniform" pixel intensity shifts across images and be a bit more robust to potentially noisier inputs.
                    
                <p><i><strong>Note: </strong>The L2_similarity metric's subtle negation of the L2 norm value helps simplify the <code>_align_single_scale</code> logic as now we always look for the largest value returned from 
                    <code>_find_similarity</code> regardless of what metric we use inside the function (as opposed to having to find the smallest value for L2 and the largest value for NCC).</i></p>
            
            <h3>Preprocessing Importance Illustrated</h3>
                <div class="image-gallery">
                    <div class="image-item">
                        <img src="media/monastery_no_crop.jpg" alt="monastery no crop alignment" width="300">
                        <p><strong>No Border Cropping</strong><br>monastery.jpg<br>Green displacement: (dx=0, dy=-6)<br>Red displacement: (dx=1, dy=9)</p>
                    </div>       
                    <div class="image-item">
                        <img src="media/monastery_aligned.jpg" alt="monastery aligned" width="300">
                        <p><strong>Border Cropped</strong><br>monastery.jpg<br>Green displacement: (dx=2, dy=-3)<br>Red displacement: (dx=2, dy=3)</p>
                    </div>     
                </div>
            
                <div class="image-gallery">
                    <div class="image-item">
                        <img src="media/lastochikino_no_crop.jpg" alt="lastochikino no crop alignment" width="300">
                        <p><strong>No Border Cropping</strong><br>lastochikino.tif<br>Green displacement: (dx=-2, dy=-4)<br>Red displacement: (dx=-3, dy=144)</p>
                    </div>       
                    <div class="image-item">
                        <img src="media/lastochikino_aligned.jpg" alt="lastochikino aligned" width="300">
                        <p><strong>Border Cropped</strong><br>lastochikino.tif<br>Green displacement: (dx=-2, dy=-2)<br>Red displacement: (dx=-8, dy=75)</p>
                    </div>
                </div>
                    
        
        
        </div> 


    
        <div class="container">
            <h2><center>Bells & Whistles (Extra) and Problems Encountered</center></h2>
                <p><strong>Better Features:</strong> The image <code>emir.tif</code> was especially problematic since it didn't have the same brightness values (i.e., had different color channels). Inspired by this headache, I modified the NCC metric function to incorporate Sobel edge maps. 
                    By applying Sobel filters before NCC, the metric focuses on comparing structural edge features (i.e., high-contrast/rapid-change regions) instead of brightness and color intensity between pixels. This addition finally enabled <code>emir.tif</code> to be recovered in all its beauty!</p>
            <div class="image-gallery">
                <div class="image-item">
                    <img src="media/emir_naive.jpg" alt="emir naive aligned" width="300">
<!--                     <p><strong>Pure NCC</strong><br>emir.tif<br>Green displacement: (dx=24, dy=49)<br>Red displacement: (dx=-542, dy=118)</p> -->
                    <p><strong>Pure NCC</strong><br>emir.tif<br>Green displacement: (dx=7, dy=-3)<br>Red displacement: (dx=17, dy=107)</p>
                </div>
                <div class="image-item">
                    <img src="media/emir_aligned.jpg" alt="emir Sobel aligned" width="300">
                    <p><strong>Edge Map + NCC</strong><br>emir.tif<br>Green displacement: (dx=24, dy=49)<br>Red displacement: (dx=40, dy=107)</p>
                </div>
            </div>
        </div>
    
    
        <div class="container">
            <h2><center>Final Postprocessing Results</h2></center>
                <h3>Lower Resolution Images (Single-scale)</h3>
                    <div class="image-gallery">
                        <div class="image-item">
                            <img src="media/cathedral_aligned.jpg" alt="cathedral aligned" width="300">
                            <p>cathedral.jpg<br>Green displacement: (dx=2, dy=5)<br>Red displacement: (dx=3, dy=12)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/monastery_aligned.jpg" alt="monastery aligned" width="300">
                            <p>monastery.jpg<br>Green displacement: (dx=2, dy=-3)<br>Red displacement: (dx=2, dy=3)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/tobolsk_aligned.jpg" alt="tobolsk aligned" width="300">
                            <p>tobolsk.jpg<br>Green displacement: (dx=3, dy=3)<br>Red displacement: (dx=3, dy=6)</p>
                        </div>
                    </div>
                
                <h3>Higher Resolution Images (Multi-scale)</h3>
                    <div class="image-gallery">
                        <div class="image-item">
                            <img src="media/church_aligned.jpg" alt="church aligned" width="300">
                            <p>church.tif<br>Green displacement: (dx=4, dy=25)<br>Red displacement: (dx=-4, dy=58)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/emir_aligned.jpg" alt="emir aligned" width="300">
                            <p>emir.tif<br>Green displacement: (dx=24, dy=49)<br>Red displacement: (dx=40, dy=107)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/harvesters_aligned.jpg" alt="harvesters aligned" width="300">
                            <p>harvesters.tif<br>Green displacement: (dx=16, dy=59)<br>Red displacement: (dx=13, dy=124)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/icon_aligned.jpg" alt="icon aligned" width="300">
                            <p>icon.tif<br>Green displacement: (dx=17, dy=41)<br>Red displacement: (dx=23, dy=89)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/italil_aligned.jpg" alt="italil aligned" width="300">
                            <p>italil.tif<br>Green displacement: (dx=21, dy=38)<br>Red displacement: (dx=35, dy=76)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/lastochikino_aligned.jpg" alt="lastochikino aligned" width="300">
                            <p>lastochikino.tif<br>Green displacement: (dx=-2, dy=-2)<br>Red displacement: (dx=-8, dy=75)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/lugano_aligned.jpg" alt="lugano aligned" width="300">
                            <p>lugano.tif<br>Green displacement: (dx=-16, dy=41)<br>Red displacement: (dx=-29, dy=92)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/melons_aligned.jpg" alt="melons aligned" width="300">
                            <p>melons.tif<br>Green displacement: (dx=10, dy=81)<br>Red displacement: (dx=13, dy=178)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/self_portrait_aligned.jpg" alt="self_portrait aligned" width="300">
                            <p>self_portrait.tif<br>Green displacement: (dx=29, dy=78)<br>Red displacement: (dx=37, dy=176)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/siren_aligned.jpg" alt="siren aligned" width="300">
                            <p>siren.tif<br>Green displacement: (dx=-6, dy=49)<br>Red displacement: (dx=-25, dy=95)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/three_generations_aligned.jpg" alt="three_generations aligned" width="300">
                            <p>three_generations.tif<br>Green displacement: (dx=14, dy=53)<br>Red displacement: (dx=11, dy=112)</p>
                        </div>
                    </div>
                
                <h3>My Own Examples</h3>
                    <div class="image-gallery">
                        <div class="image-item">
                            <img src="media/Detali_sobora_v_Milanie_aligned.jpg" alt="Detali_sobora_v_Milanie aligned" width="300">
                            <p>Detali_sobora_v_Milanie.tif<br>Green displacement: (dx=-19, dy=-10)<br>Red displacement: (dx=-56, dy=-2)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/V_oranzhereie_aligned.jpg" alt="V_oranzhereie aligned" width="300">
                            <p>V_oranzhereie.tif<br>Green displacement: (dx=28, dy=59)<br>Red displacement: (dx=34, dy=126)</p>
                        </div>
                        <div class="image-item">
                            <img src="media/woman_yurt_aligned.jpg" alt="woman_yurt aligned" width="300">
                            <p>woman_yurt.tif<br>Green displacement: (dx=38, dy=48)<br>Red displacement: (dx=55, dy=107)</p>
                        </div>
                    </div>
                
        </div>
</body>
</html>
